@model EnrollmentPortal.Models.Entities.EnrollmentHeaderFile

@{
    ViewData["Title"] = "Enrollment Detail";
}

<div>
    <div class="card card-box-shadow">
        <div class="card-header">
            <h2>Enrollment Details</h2>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <h5>Student Info</h5>
            </div>
            <div class="row mb-3">
                <div class="form-group col-sm">
                    <label asp-for="StudentFileId" class="control-label"> Student Id </label>
                    <input asp-for="StudentFileId" class="form-control" disabled />
                </div>
                <div class="form-group col-sm">
                </div>
                <div class=" form-group col-sm">
                </div>
            </div>
            <div class="row mb-3">
                <div class="form-group col-sm">
                    <label class="control-label">First Name</label>
                    <input asp-for="StudentFile.STFSTUDFNAME" class="form-control" disabled />
                </div>
                <div class=" form-group col-sm">
                    <label class="control-label">Middle Name</label>
                    <input asp-for="StudentFile.STFSTUDMNAME" class=" form-control" disabled />
                </div>
                <div class=" form-group col-sm">
                    <label class="control-label">Last Name</label>
                    <input asp-for="StudentFile.STFSTUDLNAME" class="form-control" disabled />
                </div>
            </div>
            <div class="row mb-3">
                <div class="form-group col-sm">
                    <label class="control-label">Status</label>
                    <input asp-for="StudentFile.STFSTUDSTATUS" class="form-control" disabled />
                </div>
                <div class=" form-group col-sm">
                    <label class="control-label">Course</label>
                    <input asp-for="StudentFile.Course.Code" class="form-control" disabled />
                </div>
                <div class=" form-group col-sm">
                    <label asp-for="ENRHFSTUDSEM" class="control-label">Semester</label>
                    <input asp-for="ENRHFSTUDSEM" class="form-control" disabled />
                </div>
            </div>
            <div class="row mb-3">
                <div class="form-group col-sm">
                    <label asp-for="ENRHFSTUDDATEENROLL" class="control-label">Date Enroll</label>
                    <input asp-for="ENRHFSTUDDATEENROLL" type="date" class="form-control" disabled/>
                </div>
                <div class=" form-group col-sm">
                    <label asp-for="ENRHFSTUDSCHLYR" class="control-label">School Year</label>
                    <input asp-for="ENRHFSTUDSCHLYR" class="form-control" disabled />
                </div>
                <div class=" form-group col-sm">
                    <label asp-for="ENRHFSTUDSTATUS" class="control-label">Status</label>
                    <input asp-for="ENRHFSTUDSTATUS" class="form-control" disabled />
                </div>
            </div>
            <div class="mb-3 mt-2">
                <h5>Schedules</h5>
            </div>
            <div class="mb-3">
                <table class="table d-none d-md-table table-shadow" id="scheduleTable">
                    <thead>
                        <tr class="table-primary">
                            <th>
                                EDP Code
                            </th>
                            <th>
                                Subject Code
                            </th>
                            <th>
                                Units
                            </th>
                            <th>
                                Start Time
                            </th>
                            <th>
                                End Time
                            </th>
                            <th>
                                Days
                            </th>
                            <th>
                                Room
                            </th>
                            <th>
                                Status
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be added here dynamically -->
                    </tbody>
                </table>

                <!-- Card Layout for Mobile -->
                <div class="d-md-none" id="scheduleCard">
                </div>
            </div>
            <div class="mb-3 w-25 w-md-50">
                <label asp-for="ENRHFSTUDTOTALUNITS" class="control-label"> Total Units</label>
                <input asp-for="ENRHFSTUDTOTALUNITS" id="totalUnitsField" class="form-control" value="0" disabled />
            </div>
            <div>
                <a class="btn btn-outline-primary" asp-action="Edit" asp-route-id="@Model?.Id">Edit</a>
                <a class="btn btn-outline-dark mx-3" asp-action="Index"> &#10502; Back</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {

        // Deserialize JSON in JavaScript
        const enrolledscheduleSubs = @Html.Raw(ViewData["EnrolledSchedulesJson"]);
        if (enrolledscheduleSubs.$values) {
            enrolledscheduleSubs.$values.forEach(s => {
                var newRow = `
                                <tr>
                                        <td>${s.edpCode}</td>
                                        <td>${s.subjectCode}</td>
                                        <td>${s.subjectUnits}</td>
                                        <td>${formatISOTimeTo12Hour(s.startTime)}</td>
                                        <td>${formatISOTimeTo12Hour(s.endTime)}</td>
                                        <td>${s.days}</td>
                                        <td>${s.room}</td>
                                        <td>${s.status}</td>
                                </tr>
                            `;

                // Append the new row to the schedule table
                $('#scheduleTable tbody').append(newRow);

                var cardNewRow = `
                                <div class="card card-box-shadow mb-3">
                                    <div class="card-body">
                                            <h5 class="card-title">EDP Code: ${s.edpCode} </h5>
                                        <p class="card-text">
                                                <strong> Subject Code:</strong> ${s.subjectCode} <br>
                                                <strong> Units:</strong> ${s.subjectUnits} <br>
                                                <strong>Start Time:</strong> ${formatISOTimeTo12Hour(s.startTime)} <br>
                                                <strong>End Time:</strong> ${formatISOTimeTo12Hour(s.endTime)} <br>
                                                <strong>Days:</strong> ${s.days} <br>
                                                <strong>Room:</strong> ${s.room}
                                                <strong>Room:</strong> ${s.status}
                                        </p>
                                    </div>
                                </div>
                            `;

                $('#scheduleCard').append(cardNewRow);
                if (s.status === "Active") { 
                    $('#totalUnitsField').val(parseInt($('#totalUnitsField').val() || 0) + parseInt(s.subjectUnits));
                }
            });
        }

        function formatISOTimeTo12Hour(isoDateTime) {
            // Parse the ISO 8601 string into a Date object
            const date = new Date(isoDateTime);

            // Extract hours and minutes
            const hours = date.getHours();
            const minutes = date.getMinutes();

            // Determine AM/PM
            const period = hours >= 12 ? "pm" : "am";

            // Format hours into 12-hour format
            const formattedHours = hours % 12 || 12; // Convert 0 to 12 for 12-hour format

            // Format minutes with leading zero if needed
            const formattedMinutes = minutes.toString().padStart(2, '0');

            // Return formatted time as "hh:mm tt"
            return `${formattedHours}:${formattedMinutes} ${period}`;
        }
    });
</script>
